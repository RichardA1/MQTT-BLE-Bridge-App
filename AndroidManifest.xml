<?xml version="1.0" encoding="utf-8"?>
<!--
  android/app/src/main/AndroidManifest.xml
  =========================================
  Target device : Google Pixel 5
  Android       : 13 (API 33)
  compileSdk    : 34
  minSdk        : 31  (Android 12 — enforces modern BLE permission model)
  targetSdk     : 33

  BLE permission notes for API 33 / Pixel 5:
    • BLUETOOTH_SCAN  with neverForLocation means Android will NOT ask the
      user to grant location access just to scan for BLE devices.
    • BLUETOOTH_CONNECT is required to initiate GATT connections.
    • The legacy BLUETOOTH, BLUETOOTH_ADMIN, and ACCESS_FINE_LOCATION
      permissions are NOT needed and have been intentionally omitted.
-->
<manifest xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- ── Internet access for MQTT (WiFi or mobile data) ── -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

    <!-- ── BLE permissions (API 31+ / Android 12+) ── -->
    <!--
      BLUETOOTH_SCAN: allows the app to scan for nearby BLE devices.
      neverForLocation flag tells Android this app does NOT use BLE to
      derive the user's location — so no location prompt is shown on API 33.
    -->
    <uses-permission
        android:name="android.permission.BLUETOOTH_SCAN"
        android:usesPermissionFlags="neverForLocation"
        tools:targetApi="s" />

    <!--
      BLUETOOTH_CONNECT: allows the app to connect to already-paired or
      discovered BLE devices and exchange data over GATT.
    -->
    <uses-permission
        android:name="android.permission.BLUETOOTH_CONNECT"
        tools:targetApi="s" />

    <!-- ── Declare BLE as a required hardware feature ── -->
    <!--
      required="true" means the app will not be offered on devices without
      BLE hardware in the Play Store.
    -->
    <uses-feature
        android:name="android.hardware.bluetooth_le"
        android:required="true" />

    <application
        android:name=".MainApplication"
        android:label="@string/app_name"
        android:icon="@mipmap/ic_launcher"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:allowBackup="false"
        android:theme="@style/AppTheme"
        android:usesCleartextTraffic="true">

        <!--
          usesCleartextTraffic="true" is required if your MQTT broker is
          on a plain TCP connection (mqtt:// or ws://).
          If you use TLS exclusively (mqtts:// or wss://), you can set this
          to false for better security.
        -->

        <activity
            android:name=".MainActivity"
            android:label="@string/app_name"
            android:configChanges="keyboard|keyboardHidden|orientation|screenLayout|screenSize|smallestScreenSize|uiMode"
            android:launchMode="singleTask"
            android:windowSoftInputMode="adjustResize"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

    </application>

</manifest>
